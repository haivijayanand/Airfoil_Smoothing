function [second_derivative]=ddS(x,K,r,n,N1,N2)
%
% -------------------------------------------------------------------------
% PURPOSE - Calculate 2nd derivative of z(x) function
% -------------------------------------------------------------------------
% Coded by: Massimiliano Di Muzio - November 2008
% -------------------------------------------------------------------------

second_derivative = (1 - x)^(N2 + n - r)*K*(-x^(N1 + r)*N1 - 2*x^(N1 - 1 + r)*N1^2+ ...
               -2*x^(N1 - 1 + r)*N1*n - 2*x^(N1 - 1 + r)*N1*r + 2*x^(N1 - 1+ r)*N1+ ...
               x^(N1 + r)*N2^2-x^(N1 + r)*N2+x^(N1 - 2 + r)*N1^2-x^(N1 - 2 + r)*N1+ ...
                                  x^(N1 - 2 + r)*r^2-x^(N1 - 2 + r)*r-x^(N1 + r)*n+ ...
               -2*x^(N1 - 1 + r)*N1*N2+2*x^(N1 - 2 + r)*N1*r-2*x^(N1 - 1 + r)*N2*r+ ...
                             2*x^(N1 + r)*N2*n-2*x^(N1 - 1 + r)*r*n+x^(N1 + r)*n^2+ ...
                                2*x^(N1 + r)*N1*N2+2*x^(N1 + r)*N1*n+x^(N1+r)*N1^2+ ...
                                                      2*x^(N1 - 1 + r)*r)/(-1+x)^2;
end